<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Dashboard Ph·∫£n H·ªìi Ch·∫•m C√¥ng ‚Äì WAREHOUSE RYOBI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font ti·∫øng Vi·ªát chu·∫©n -->
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;600;700;900&display=swap" rel="stylesheet">

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* ======= GLOBAL ======= */
    body {
        font-family: 'Be Vietnam Pro', sans-serif;
        margin: 20px;
        background: #f5f7fa;
        transition: background 0.4s, color 0.4s;
    }

    body.dark {
        background: #121212;
        color: #eaeaea;
    }

    /* ======= TITLE NEON POSTER ======= */
    h1 {
        font-size: 42px;
        font-weight: 900;
        text-align: center;
        margin-bottom: 15px;
        background: linear-gradient(90deg, #4facfe, #00f2fe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;

        /* Hi·ªáu ·ª©ng Glow */
        text-shadow:
            0 0 8px rgba(0, 255, 255, 0.5),
            0 0 16px rgba(0, 128, 255, 0.4),
            0 0 24px rgba(0, 128, 255, 0.3);
    }

    h2 {
        margin-top: 25px;
        font-size: 26px;
    }

    /* ======= SEARCH BAR ======= */
    .search-bar input {
        padding: 8px;
        width: 180px;
        margin-right: 5px;
        border-radius: 6px;
        border: 1px solid #bbb;
    }
    .search-bar button {
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        border: none;
        background: linear-gradient(90deg, #4facfe, #00f2fe);
        color: white;
        font-weight: 700;
    }

    /* ======= DARK MODE BUTTON ======= */
    .toggle-dark {
        float: right;
        margin-top: -60px;
        margin-right: 10px;
        cursor: pointer;
        background: #222;
        padding: 10px 14px;
        color: white;
        border-radius: 8px;
    }

    /* ======= TABLE ======= */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        transition: background 0.4s, color 0.4s;
    }
    body.dark table {
        background: #1e1e1e;
        color: white;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
    }
    th {
        background: #eef1f5;
    }
    body.dark th {
        background: #2c2c2c;
        color: white;
    }

    .badge {
        padding: 4px 12px;
        border-radius: 16px;
        font-size: 12px;
        color: #fff;
    }
    .confirm-none { background: #ff6b6b; }
    .confirm-done { background: #2ecc71; }

    /* ======= FOOTER CHART LAYOUT ======= */
    .footer-charts {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        margin-top: 30px;
    }

    .row-2 {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 20px;
    }

    .chart-box {
        background: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        transition: background 0.4s, color 0.4s;
    }
    body.dark .chart-box {
        background: #1e1e1e;
        color: white;
    }

    /* ======= PAGINATION ======= */
    .pagination {
        margin-top: 15px;
        text-align: center;
    }
    .pagination button {
        padding: 6px 12px;
        margin: 2px;
        border: none;
        background: #4facfe;
        color: white;
        border-radius: 6px;
        cursor: pointer;
    }

    /* ======= AUDIO ======= */
    audio { display: none; }
</style>
</head>

<body>

<h1>Dashboard Ph·∫£n H·ªìi Ch·∫•m C√¥ng ‚Äì WAREHOUSE RYOBI</h1>

<div class="toggle-dark" onclick="toggleDark()">üåô Dark Mode</div>

<p>üìå D·ªØ li·ªáu c·∫≠p nh·∫≠t t·ª± ƒë·ªông.</p>

<!-- SEARCH -->
<div class="search-bar">
    <input id="searchMSNV" placeholder="T√¨m MSNV‚Ä¶">
    <input id="searchName" placeholder="T√¨m h·ªç t√™n‚Ä¶">
    <button onclick="applySearch()">L·ªçc</button>
    <button onclick="resetFilter()">X√≥a</button>
</div>

<h2>Danh s√°ch chi ti·∫øt</h2>

<table id="dataTable">
    <thead>
        <tr>
            <th onclick="sortBy('MSNV')">MSNV ‚¨ç</th>
            <th>H·ªç t√™n</th>
            <th onclick="sortBy('NgayDieuChinh')">Ng√†y ƒëi·ªÅu ch·ªânh ‚¨ç</th>
            <th>N·ªôi dung</th>
            <th>Confirm</th>
            <th>BU</th>
            <th>Team</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="pagination" id="pagination"></div>

<!-- FOOTER CHARTS -->
<h2>Bi·ªÉu ƒë·ªì ph·ª•</h2>

<div class="footer-charts">

    <div class="row-2">
        <div class="chart-box">
            <h3>Theo BU</h3>
            <canvas id="chartBU"></canvas>
        </div>

        <div class="chart-box">
            <h3>Theo Team</h3>
            <canvas id="chartTeam"></canvas>
        </div>
    </div>

    <div class="chart-box">
        <h3>Top ph·∫£n h·ªìi</h3>
        <canvas id="chartTop"></canvas>
    </div>

    <div class="chart-box">
        <h3>Theo ng√†y ch·ªânh</h3>
        <canvas id="chartNgay"></canvas>
    </div>

</div>

<!-- Background Music -->
<audio id="bgMusic" loop>
    <source src="videoplayback.m4a" type="audio/mpeg">
</audio>

<script>
const jsonUrl = "https://hoailuan0311-code.github.io/ChamCongDashboard/data.json";
let fullData = [];
let tablePage = 1;
const pageSize = 15;

/* ================= LOAD DATA ================= */
async function loadData() {
    let res = await fetch(jsonUrl + "?cache=" + Date.now());
    fullData = await res.json();
    renderAll(fullData);
}
loadData();

/* ================= DATE FORMAT ================= */
function excelDate(v){
    if (!v) return "";
    const d = new Date((v - 25569) * 86400 * 1000);
    return isNaN(d) ? v : d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"});
}

/* ================= RENDER ALL ================= */
function renderAll(data){
    renderTable(data);
    renderBU(data);
    renderTeam(data);
    renderTop(data);
    renderNgay(data);
}

/* ================= TABLE ================= */
function renderTable(data){
    let tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    let start = (tablePage - 1) * pageSize;
    let pageData = data.slice(start, start + pageSize);

    pageData.forEach(r => {
        tbody.innerHTML += `
        <tr>
            <td>${r.MSNV || ""}</td>
            <td>${r.FullName || ""}</td>
            <td>${excelDate(r.NgayDieuChinh)}</td>
            <td>${r.NoiDung || ""}</td>
            <td><span class="badge ${r.ConfirmAdmin ? "confirm-done" : "confirm-none"}">
                ${r.ConfirmAdmin || "Ch∆∞a ph·∫£n h·ªìi"}
            </span></td>
            <td>${r.BU}</td>
            <td>${r.Team}</td>
        </tr>`;
    });

    renderPagination(data.length);
}

/* ================= PAGINATION ================= */
function renderPagination(total){
    let pages = Math.ceil(total / pageSize);
    let div = document.getElementById("pagination");
    div.innerHTML = "";

    for (let i = 1; i <= pages; i++){
        div.innerHTML += `<button onclick="goPage(${i})">${i}</button>`;
    }
}

function goPage(p){
    tablePage = p;
    renderAll(fullData);
}

/* ================= SEARCH ================= */
function applySearch(){
    let ms = searchMSNV.value.toLowerCase();
    let nm = searchName.value.toLowerCase();

    let f = fullData.filter(r =>
        (!ms || (r.MSNV+"").toLowerCase().includes(ms)) &&
        (!nm || (r.FullName+"").toLowerCase().includes(nm))
    );
    renderAll(f);
}

function resetFilter(){
    searchMSNV.value = "";
    searchName.value = "";
    renderAll(fullData);
}

/* ================= SORTING ================= */
function sortBy(col){
    fullData.sort((a,b)=> (a[col] > b[col] ? 1 : -1));
    renderAll(fullData);
}

/* ================= CHARTS ================= */
function renderBU(data){
    const c = {};
    data.forEach(r => c[r.BU] = (c[r.BU] || 0) + 1);

    new Chart(chartBU,{
        type:"pie",
        data:{
            labels:Object.keys(c),
            datasets:[{ data:Object.values(c), backgroundColor:["#ff6384","#36a2eb"] }]
        },
        options:{ animation:{ duration:1200, easing:"easeOutBounce" } }
    });
}

function renderTeam(data){
    const c = {};
    data.forEach(r => c[r.Team] = (c[r.Team] || 0) + 1);

    new Chart(chartTeam,{
        type:"bar",
        data:{
            labels:Object.keys(c),
            datasets:[{ data:Object.values(c), backgroundColor:"#ffa64d" }]
        },
        options:{
            animation:{ duration:1500, easing:"easeOutElastic" }
        }
    });
}

function renderTop(data){
    const c = {};
    data.forEach(r=> c[r.FullName] = (c[r.FullName]||0)+1);
    let s = Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,10);

    new Chart(chartTop,{
        type:"bar",
        data:{
            labels:s.map(x=>x[0]),
            datasets:[{ data:s.map(x=>x[1]), backgroundColor:"#00c9ff" }]
        },
        options:{
            animation:{ duration:1000, easing:"easeOutQuad" }
        }
    });
}

function renderNgay(data){
    const c = {};
    data.forEach(r=>{
        let d = excelDate(r.NgayDieuChinh);
        c[d] = (c[d]||0)+1;
    });

    new Chart(chartNgay,{
        type:"bar",
        data:{
            labels:Object.keys(c),
            datasets:[{ data:Object.values(c), backgroundColor:"#9b59b6" }]
        },
        options:{ animation:{ duration:1200, easing:"easeOutBounce" } }
    });
}

/* ================= DARK MODE ================= */
function toggleDark(){
    document.body.classList.toggle("dark");
}

/* ================= AUTO MUSIC ================= */
const music = document.getElementById("bgMusic");
document.addEventListener("touchstart", ()=>music.play(), {once:true});
document.addEventListener("click", ()=>music.play(), {once:true});
music.play().catch(()=>{});
</script>

</body>
</html>
